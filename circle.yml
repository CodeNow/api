machine:
  environment:
    NODE_ENV: testing
    LOG_LEVEL: none
    LOG_LEVEL_STDOUT: error
    DEBUG: hermes:*
dependencies:
  cache_directories:
    - neo4j-community-2.1.8
  pre:
    - if [[ ! -e neo4j-community-2.1.8 ]]; then wget http://neo4j.com/artifact.php?name=neo4j-community-2.1.8-unix.tar.gz -O neo4j-community-2.1.8-unix.tar.gz && tar -xzvf neo4j-community-2.1.8-unix.tar.gz; fi
    - neo4j-community-2.1.8/bin/neo4j start:
        background: true
    - timeout 1m ./scripts/set-neo4j-constraint.sh
  override:
    - nvm install 0.10.38
    - nvm alias default 0.10.38
    - npm install -g npm@2.8.3
    - npm install
test:
  pre:
    - ulimit -n 10240
  override:
    - npm run lint
    - timeout 5m npm run unit
    - timeout 15m ./scripts/npm-bdd-split-files.sh:
        parallel: true
  post:
    - npm run eslint-changes-errors || true
